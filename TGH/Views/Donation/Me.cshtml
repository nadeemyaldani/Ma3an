@using TGH.Models;
@using TGH.Helpers;
@model List<Donation>
@{
    var groupedDonations = Model.GroupBy(d => d.CategoryId);
    var categories = ViewData["Categories"] as List<Category>;
    var key = ViewData["Key"].ToString();
    var donationId = ViewData["DonationId"];
    var confirmMessage = language.Getkey("DONATION_DELETE_CONFIRM").Value;
}

<head>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"
            integrity="sha256-xH4q8N0pEzrZMaRmd7gQVcTZiFei+HfRTBPJ1OGXC0k="
            crossorigin="anonymous"></script>

    <style type="text/css">
        .box-flash {
            background-color: #2DCDCB !important;
        }
    </style>
</head>
<!-- Slider Start -->
<div class="section slider-section-page">



</div>
<div class="section section-padding-02">
    <div class="container">

        <!-- All Courses Top Start -->
        <div class="courses-top">

            <!-- Section Title Start -->
            <div class="section-title shape-01">
                <h2 class="main-title">
                    <span>
                        @language.Getkey("TITLE_DONATIONS_1")
                    </span> @language.Getkey("TITLE_DONATIONS_2")
                </h2>
            </div>
            <!-- Section Title End -->
            <!-- Courses Search Start -->
            <div style="display: flex;">
                    <div class="courses-search">
                        <a class="btn btn-primary btn-hover-dark" href="/donation/add">@language.Getkey("HOME_DONATENOW")</a>
                    </div>
                    @*<div class="courses-search">
                        <form asp-action="me" method="get">
                            <input type="text" name="key" value="@key" placeholder="@language.Getkey("HOME_SEARCHCITY")">
                            <button type="submit"><i class="flaticon-magnifying-glass"></i></button>
                        </form>
                    </div>*@
                </div>
            <!-- Courses Search End -->

        </div>
        <!-- All Courses Top End -->
        <!-- All Courses Tabs Menu Start -->
        <div class="courses-tabs-menu courses-active">
            <div class="swiper-container">
                <ul class="swiper-wrapper nav">
                    <li class="swiper-slide"><button class="active" data-bs-toggle="tab" data-bs-target="#tabs_0">@language.Getkey("ALL")</button></li>
                    @foreach (Category category in categories)
                    {
                        <li class="swiper-slide">
                            <button data-bs-toggle="tab" data-bs-target="#tabs_@category.Id">
                                @if (language.Arabic)
                                {
                                    @category.NameAr
                                }
                                else
                                {
                                    @category.NameEn
                                }
                            </button>
                        </li>
                    }
                </ul>
            </div>

            <!-- Add Pagination -->
            <div class="swiper-button-next"><i class="icofont-rounded-right"></i></div>
            <div class="swiper-button-prev"><i class="icofont-rounded-left"></i></div>
        </div>
        <!-- All Courses Tabs Menu End -->
        <!-- All Courses tab content Start -->
        <div class="tab-content courses-tab-content">
            <div class="tab-pane fade show active" id="tabs_0">
                <!-- All Courses Wrapper Start -->
                <div class="courses-wrapper">
                    <div class="row">
                        @foreach (Donation donation in Model)
                        {
                          
                        <div class="col-lg-4 col-md-6 donation-card">
                            <!-- Single Courses Start -->
                           
                            <div id="donation_@donation.Id" class="single-courses">
                                @if (!@donation.Publish)
                                {
                                    if (language.Arabic)
                                    {
                                        <div class="donation-status">
                                            <label> لم يتم النشر (قيد المراجعة من قبل مدير النظام) شكرا لمشاركتكم</label>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="donation-status">
                                            <label> Not Published (Under review by system admin) thank you for your donation</label>
                                        </div>
                                    }

                                }

                                <div class="courses-images">
                                    @if (donation.Images != null && donation.Images.Any())
                                    {
                                        <a href="/home/Chat"><img src="data:image/jpeg;base64,@donation.Images.FirstOrDefault()?.Content" alt="Courses"></a>
                                    }
                                    else
                                    {
                                        <a href="/home/Chat"><img src="~/maan/assets/images/donation-placeholder.jpeg" alt="Courses"></a>
                                    }
                                </div>
                                <div class="courses-content">
                                    <h4 class="title"><a href="/home/Chat">@donation.Title</a></h4>
                                    <div class="courses-meta">
                                        @{
                                            var date = (DateTime.Now - donation.Date).TotalHours;
                                            double time = -1.0;
                                            if (date < 1)
                                            {
                                                time = Math.Floor((DateTime.Now - donation.Date).TotalMinutes);
                                            }
                                        }

                                        @if (time == 0)
                                        {
                                            <span> <i class="icofont-clock-time"></i> @language.Getkey("NOW") </span>
                                        }
                                        else if (time > -1)
                                        {
                                            if (Math.Floor(time) <= 10)
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(time) @language.Getkey("MINUTES")</span>
                                            }
                                            else
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(time) @language.Getkey("MINUTE")</span>
                                            }
                                        }
                                        else if (date < 24)
                                        {
                                            if (date <= 10)
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(date) @language.Getkey("HOURS")</span>
                                            }
                                            else
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(date) @language.Getkey("HOUR")</span>
                                            }
                                        }
                                        else
                                        {
                                            if (@Math.Floor(date / 24) <= 10)
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(date / 24) @language.Getkey("DAYS")</span>
                                            }
                                            else
                                            {
                                                <span> <i class="icofont-clock-time"></i> @Math.Floor(date / 24) @language.Getkey("DAY")</span>
                                            }
                                        }
                                        @if (language.Arabic)
                                        {
                                            <span> <i class="icofont-location-pin"></i> @donation.City.NameAR </span>
                                        }
                                        else
                                        {
                                            <span> <i class="icofont-location-pin"></i> @donation.City.NameEN </span>
                                        }
                                    </div>
                                    <br>
                                    <div class="courses-author">
                                        <div class="author">
                                            <div class="author-thumb">
                                                @if (donation.User.Image == null)
                                                {
                                                    <a><img src="~/maan/assets/images/man.svg" alt="Author"></a>
                                                }
                                                else
                                                {
                                                    <a><img src="data:image/jpeg;base64,@donation.User.Image" alt="Author"></a>
                                                }
                                            </div>
                                            <div class="author-name">
                                                <a class="name">@donation.User.FullName</a>
                                            </div>
                                        </div>
                                        <div onclick="DeleteDonation(@donation.Id)" class="btn btn-danger">
                                            <a>@language.Getkey("DELETE")</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Single Courses End -->
                        </div>
                        }
                    </div>
                </div>
                <!-- All Courses Wrapper End -->
            </div>

            @foreach (Category category in categories)
            {
                <div class="tab-pane fade" id="tabs_@category.Id">
                    <!-- All Courses Wrapper Start -->
                    <div class="courses-wrapper">
                        <div class="row">
                            @{
                                var donations = groupedDonations.FirstOrDefault(o => o.Key == category.Id);
                            }
                            @if (donations != null)
                            {
                                foreach (Donation donation in donations)
                                {
                                    <div class="col-lg-4 col-md-6">
                                        <!-- Single Courses Start -->
                                        <div class="single-courses">
                                            <div class="courses-images">
                                                @if (donation.Images != null && donation.Images.Any())
                                                {
                                                    <a href="/home/Chat"><img src="data:image/jpeg;base64,@donation.Images.FirstOrDefault()?.Content" alt="Courses"></a> }
                                                else
                                                {
                                                    <a href="/home/Chat"><img src="~/maan/assets/images/donation-placeholder.jpeg" alt="Courses"></a>
                                                }
                                            </div>
                                            <div class="courses-content">
                                                <h4 class="title"><a href="/home/Chat">@donation.Title</a></h4>
                                                <div class="courses-meta">
                                                    @{
                                                        var date = (DateTime.Now - donation.Date).TotalHours;
                                                        double time = -1.0;
                                                        if (date < 1)
                                                        {
                                                            time = Math.Floor((DateTime.Now - donation.Date).TotalMinutes);
                                                        }
                                                    }

                                                    @if (time == 0)
                                                    {
                                                        <span> <i class="icofont-clock-time"></i> @language.Getkey("NOW") </span>
                                                    }
                                                    else if (time > -1)
                                                    {
                                                        if (Math.Floor(time) <= 10)
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(time) @language.Getkey("MINUTES")</span>
                                                        }
                                                        else
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(time) @language.Getkey("MINUTE")</span>
                                                        }
                                                    }
                                                    else if (date < 24)
                                                    {
                                                        if (date <= 10)
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(date) @language.Getkey("HOURS")</span>
                                                        }
                                                        else
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(date) @language.Getkey("HOUR")</span>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (@Math.Floor(date / 24) <= 10)
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(date / 24) @language.Getkey("DAYS")</span>
                                                        }
                                                        else
                                                        {
                                                            <span> <i class="icofont-clock-time"></i> @Math.Floor(date / 24) @language.Getkey("DAY")</span>
                                                        }
                                                    }
                                                    @if (language.Arabic)
                                                    {
                                                        <span> <i class="icofont-location-pin"></i> @donation.City.NameAR </span>
                                                    }
                                                    else
                                                    {
                                                        <span> <i class="icofont-location-pin"></i> @donation.City.NameEN </span>
                                                    }
                                                </div>
                                                <br>
                                                <div class="courses-author">
                                                    <div class="author">
                                                        <div class="author-thumb">
                                                            @if (donation.User.Image == null)
                                                            {
                                                                <a><img src="~/maan/assets/images/man.svg" alt="Author"></a>
                                                            }
                                                            else
                                                            {
                                                                <a><img src="data:image/jpeg;base64,@donation.User.Image" alt="Author"></a>
                                                            }
                                                        </div>
                                                        <div class="author-name">
                                                            <a class="name">@donation.User.FullName</a>
                                                        </div>
                                                    </div>
                                                    <div onclick="DeleteDonation(@donation.Id)" class="btn btn-danger">
                                                        <a>@language.Getkey("DELETE")</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Single Courses End -->
                                    </div>
                                }
                            }
                        </div>
                    </div>
                    <!-- All Courses Wrapper End -->
                </div>
            }
            <input type="hidden" id="hdnConfirmMessage" value="@language.Getkey("DONATION_DELETE_CONFIRM")" />
        </div>
        <!-- All Courses tab content End -->
        <!-- All Courses BUtton Start -->
        @*<div class="courses-btn text-center">
                <a href="#" class="btn btn-secondary btn-hover-primary">المزيد </a>
            </div>*@
        <!-- All Courses BUtton End -->
        <br><br>
    </div>
</div>

<script>

    $(document).ready(function () {

        var donationId = '@donationId';

        if (donationId != '') {
            $([document.documentElement, document.body]).animate({
                scrollTop: $("#donation_" + donationId).offset().top
            }, 1000);

            setTimeout(function () {
                $("#donation_" + donationId).toggleClass("box-flash");
            }, 1000);

            setTimeout(function () {
                $("#donation_" + donationId).toggleClass("box-flash");
            }, 3000);
        }

    })

    function DeleteDonation(id) {

        if (confirm($("#hdnConfirmMessage").val())) {
            window.location.href = '@Url.Action("Delete", "Donation")?id=' + id;
        } else {

        }
    }

</script>